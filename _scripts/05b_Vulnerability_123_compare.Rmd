---
title: "vulnerability 123 sensitivity"
author: "Leslie Roberson"
date: "07/02/2022"
output: html_document
---

```{r setup, include=FALSE}

library(tidyverse)
library(here)
library(pillar)
library(janitor)

knitr::opts_chunk$set(echo = TRUE)
```

load results

```{r load dat}

suscept123 <- read_csv(here("_results/Susceptibility/S_0123_scores.csv"))
traits123 <- read_csv(here("_results/Productivity/P_scores.csv"))

glimpse(suscept123)
glimpse(traits123)

S123 <- suscept123 %>% dplyr::select(c(species_id, gear, suscept0123))
P123 <- traits123 %>% dplyr::select(c(aquamaps_id, productivity))

V123 <- left_join(S123, P123, by=c("species_id"="aquamaps_id")) %>%
  rename(P=productivity, S=suscept0123) %>%
  dplyr::select(c(species_id, gear, P, S))

n_distinct(V123$species_id) # 319

which(is.na(V123$species_id)) # none
which(is.na(V123$gear)) # none
which(is.na(V123$P)) # none
which(is.na(V123$S)) # none
glimpse(V123)

```

Calculate Euclidean distance

euclidean <- function(P, S) sqrt(sum((a - b)^2))
V is the Euclidean distance of the point (4 - P, S)
The adjustment for P occurs because high productivity is associated with low vulnerability (Grewelle et al 2022)

```{r Vuln calc}

V123$V <- sqrt((V123$P^2 + V123$S^2))
glimpse(V123) # 730 interactions
V123 <- V123 %>% 
  rename(V123=V) %>% 
  dplyr::select(-P) %>%
  mutate(species_id=stringr::str_replace_all(species_id, "-", "_"))

## add results to weighted probabliity results df
V.summ <- read_csv(here("_results/vulnerability/Vulnerability_summ.csv"))
glimpse(V.summ)#730 rows

V.summ <- left_join(V.summ, V123, by=c("species_id", "gear"))
glimpse(V.summ)
V.summ %>% filter(is.na(V123)) # none

write_csv(V.summ, here("_results/vulnerability/Vulnerability_summ.csv"))
  
```
